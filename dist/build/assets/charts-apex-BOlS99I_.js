document.addEventListener("DOMContentLoaded",function(){fetch("/dashboard/analytics/visitors/data").then(e=>e.json()).then(e=>{c(e.visitor_stats),d(e.visitor_stats),m(e.user_stats),l(e.country_stats),u(e.visitor_stats.active_visitors)}).catch(e=>{console.error("خطأ في جلب بيانات التحليلات:",e)})});function c(e){if(!document.getElementById("visitorsChart"))return;const o=[],t=[];e.history.forEach(s=>{o.push(s.hour),t.push(s.count)});const n={chart:{height:350,type:"area",toolbar:{show:!1},fontFamily:"Cairo, sans-serif",dir:"rtl"},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},series:[{name:"الزوار",data:t}],xaxis:{categories:o,labels:{style:{fontFamily:"Cairo, sans-serif"}}},yaxis:{labels:{style:{fontFamily:"Cairo, sans-serif"}}},tooltip:{x:{format:"HH:mm"}},colors:["#7367F0"],fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.7,opacityTo:.2,stops:[0,90,100]}},grid:{borderColor:"#f1f1f1",padding:{left:10,right:10}},legend:{position:"top",horizontalAlign:"right",fontFamily:"Cairo, sans-serif"}};new ApexCharts(document.getElementById("visitorsChart"),n).render()}function l(e){if(!document.getElementById("countryChart"))return;const o=[],t=[];e.forEach(s=>{o.push(s.country),t.push(s.count)});const n={chart:{type:"bar",height:350,toolbar:{show:!1},fontFamily:"Cairo, sans-serif",dir:"rtl"},plotOptions:{bar:{horizontal:!0,distributed:!0,barHeight:"70%",dataLabels:{position:"top"}}},dataLabels:{enabled:!0,offsetX:-6,style:{fontSize:"12px",fontWeight:400,fontFamily:"Cairo, sans-serif"}},series:[{name:"الزوار",data:t}],xaxis:{categories:o,labels:{style:{fontFamily:"Cairo, sans-serif"}}},yaxis:{labels:{style:{fontFamily:"Cairo, sans-serif"}}},colors:["#7367F0","#00CFE8","#28C76F","#FF9F43","#EA5455","#4B4B4B","#A8A8A8","#FFCB00","#6610F2","#1E1E1E"],legend:{show:!1},tooltip:{y:{formatter:function(s){return s+" زائر"}}}};new ApexCharts(document.getElementById("countryChart"),n).render()}function d(e){const o=document.getElementById("currentVisitors");o&&(o.textContent=e.current);const t=document.getElementById("totalToday");t&&(t.textContent=e.total_today);const n=document.getElementById("visitorChange");if(n){const a=e.change,s=a>=0;n.textContent=`${s?"+":""}${a}%`,n.classList.remove("text-success","text-danger"),n.classList.add(s?"text-success":"text-danger");const r=document.getElementById("visitorChangeIcon");r&&(r.classList.remove("fa-arrow-up","fa-arrow-down"),r.classList.add(s?"fa-arrow-up":"fa-arrow-down"))}}function m(e){const o=document.getElementById("totalUsers");o&&(o.textContent=e.total);const t=document.getElementById("activeUsers");t&&(t.textContent=e.active);const n=document.getElementById("newUsers");n&&(n.textContent=e.new_today)}function u(e){const o=document.getElementById("activeVisitorsTable");if(o&&(o.innerHTML="",e.forEach(t=>{const n=document.createElement("tr"),a=document.createElement("td");a.className="visitor-ip",a.textContent=t.ip;const s=document.createElement("td");s.className="visitor-location",s.textContent=t.country?`${t.country}${t.city?` - ${t.city}`:""}`:"غير معروف";const r=document.createElement("td");r.className="visitor-browser",r.textContent=t.browser?`${t.browser}${t.os?` / ${t.os}`:""}`:"غير معروف";const i=document.createElement("td");i.textContent=h(t.last_active),n.appendChild(a),n.appendChild(s),n.appendChild(r),n.appendChild(i),o.appendChild(n)}),e.length===0)){const t=document.createElement("tr"),n=document.createElement("td");n.colSpan=4,n.className="text-center",n.textContent="لا يوجد زوار نشطين حالياً",t.appendChild(n),o.appendChild(t)}}function h(e){const o=new Date(e),t={hour:"2-digit",minute:"2-digit",hour12:!0,day:"numeric",month:"short"};return o.toLocaleString("ar-SA",t)}
