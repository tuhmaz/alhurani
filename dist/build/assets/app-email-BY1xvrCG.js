if(window.Quill){const e=["DOMNodeInserted","DOMNodeRemoved","DOMSubtreeModified"],n=EventTarget.prototype.addEventListener;EventTarget.prototype.addEventListener=function(t,o,s){if(!e.includes(t))return n.call(this,t,o,s)},window.katex&&(window.katex.options={throwOnError:!1,strict:!1})}const m=(e,n="success")=>{const t=document.createElement("div");t.className=`toast align-items-center text-white bg-${n} border-0`,t.setAttribute("role","alert"),t.setAttribute("aria-live","assertive"),t.setAttribute("aria-atomic","true"),t.innerHTML=`
    <div class="d-flex">
      <div class="toast-body">${e}</div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
  `,document.body.appendChild(t),new bootstrap.Toast(t,{animation:!0,autohide:!0,delay:3e3}).show()};document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".confirm-delete").forEach(e=>{e.addEventListener("click",async()=>{const n=e.dataset.messageId,t=e.closest(".modal");try{e.disabled=!0;const o=e.innerHTML;e.innerHTML='<i class="ti ti-loader ti-spin me-1"></i> Deleting...';const s=await fetch(`${window.location.pathname}/${n}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content,Accept:"application/json"}});if(s.ok){const a=await s.json();bootstrap.Modal.getInstance(t).hide();const i=document.querySelector(`[data-message-id="${n}"]`);i&&i.remove(),m(a.message||"Message deleted successfully","success"),window.location.reload()}else throw new Error("Failed to delete message")}catch(o){console.error("Error deleting message:",o),m("An error occurred while deleting the message","danger")}finally{e.disabled=!1,e.innerHTML='<i class="ti ti-trash me-1"></i> Delete'}})}),document.querySelectorAll(".modal").forEach(e=>{e.addEventListener("shown.bs.modal",()=>{e.removeAttribute("aria-hidden")})}),document.querySelectorAll('[id^="messageModal"]').forEach(e=>{const n=e.id.replace("messageModal",""),t=document.querySelector(`#editor${n}`);if(!t)return;const o=new Quill(t,{modules:{toolbar:[["bold","italic","underline"],[{list:"ordered"},{list:"bullet"}],["link"],["clean"]]},placeholder:"Type your reply here...",theme:"snow"}),s=e.querySelector(".quick-reply-form"),a=e.querySelector(".message-reply-toggle"),r=e.querySelector(".message-reply-form");s&&s.addEventListener("submit",async i=>{i.preventDefault();const g=o.root.innerHTML.trim();if(!g){alert("Please enter a reply message.");return}const l=s.querySelector(".quick-reply-btn");l.disabled=!0,l.innerHTML='<i class="ti ti-send me-1"></i> Sending...';const d=document.createElement("input");d.type="hidden",d.name="message",d.value=g,s.appendChild(d);try{const c=new FormData(s),u=await(await fetch(s.action,{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},body:c})).json();if(u.success)bootstrap.Modal.getInstance(e).hide(),m(u.message||"Message sent successfully","success"),o.setText(""),window.location.reload();else throw new Error(u.message||"Failed to send message")}catch(c){console.error("Error sending message:",c),m(c.message||"An error occurred while sending the message.","danger")}finally{l.disabled=!1,l.innerHTML='<i class="ti ti-send me-1"></i> Send Reply'}}),a&&r&&a.addEventListener("click",()=>{r.classList.toggle("show"),r.classList.contains("show")&&o.focus()})})});
