let s={primary:"#696cff",secondary:"#8592a3",info:"#03c3ec",warning:"#ffab00"},n,i,c,d;document.addEventListener("DOMContentLoaded",()=>{u(),p(),setInterval(p,5e3)});function u(){n=new ApexCharts(document.querySelector("#cpuChart"),{chart:{height:200,type:"line",zoom:{enabled:!1},toolbar:{show:!1}},series:[{name:"CPU Usage",data:[]}],colors:[s.primary],dataLabels:{enabled:!1},stroke:{curve:"smooth",width:3},grid:{borderColor:"#f1f1f1",padding:{top:10,right:0,bottom:0,left:0}},xaxis:{categories:[],labels:{show:!1}},yaxis:{max:100,labels:{formatter:e=>`${e}%`}}}),n.render(),i=new ApexCharts(document.querySelector("#memoryChart"),{chart:{height:200,type:"donut"},series:[0,0],labels:["Used","Free"],colors:[s.primary,s.secondary],legend:{position:"bottom"}}),i.render(),c=new ApexCharts(document.querySelector("#diskChart"),{chart:{height:200,type:"donut"},series:[0,0],labels:["Used","Free"],colors:[s.warning,s.secondary],legend:{position:"bottom"}}),c.render(),d=new ApexCharts(document.querySelector("#loadChart"),{chart:{height:100,type:"area",sparkline:{enabled:!0}},series:[{name:"Load",data:[]}],colors:[s.info],fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.7,opacityTo:.3}}}),d.render()}async function p(){try{const e=await fetch("/dashboard/performance/metrics/data",{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const r=await e.json();m(r),h(r),f(r.time)}catch(e){console.error("Error updating metrics:",e)}}function m(e){if(n&&n.updateSeries([{name:"CPU Usage",data:[e.cpu.usage_percentage]}]),i){const r=e.memory.used/e.memory.total*100,o=100-r;i.updateSeries([r,o])}if(c){const r=e.disk.used/e.disk.total*100,o=100-r;c.updateSeries([r,o])}d&&d.updateSeries([{name:"Load",data:e.cpu.load}])}function h(e){t("system-info",`${e.os} (${e.version.system})`),t("php-version",e.php_version),t("laravel-version",e.version.laravel),t("server-software",e.server_software),t("cpu-cores",e.cpu.cores),t("cpu-usage",`${e.cpu.usage_percentage.toFixed(2)}%`),t("cpu-load",e.cpu.load.map(r=>r.toFixed(2)).join(" | ")),t("memory-total",a(e.memory.total)),t("memory-used",a(e.memory.used)),t("memory-free",a(e.memory.free)),t("memory-percentage",`${e.memory.usage_percentage}%`),t("disk-total",a(e.disk.total)),t("disk-used",a(e.disk.used)),t("disk-free",a(e.disk.free)),t("disk-percentage",`${e.disk.usage_percentage}%`),t("db-type",`${e.database.type} (${e.database.version})`),t("db-name",e.database.name),t("db-size",e.database.size)}function f(e){const r=new Date(e*1e3);t("last-updated",r.toLocaleString())}function t(e,r){const o=document.getElementById(e);o&&(o.textContent=r)}function a(e){if(e===0)return"0 B";const r=1024,o=["B","KB","MB","GB","TB"],l=Math.floor(Math.log(e)/Math.log(r));return parseFloat((e/Math.pow(r,l)).toFixed(2))+" "+o[l]}
